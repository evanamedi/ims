<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Product API</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="/static/style.css" />
	</head>
	<body>
		<div>
			<div>
				<ul>
					<li>
						<a href="/supplier">Supplier</a>
					</li>
				</ul>
			</div>
			<div class="flex-container">
				<div>
					<!-- Get All Products -->
					<button class="all" id="get-all">Get All Products</button>
				</div>

				<div>
					<!-- Form for adding a new Product -->
					<h1>Add Product</h1>
					<form id="add-form">
						<label for="supplier_id">Supplier ID:</label><br />
						<input
							type="text"
							class="submit_field"
							id="supplier_id"
							name="supplier_id"
						/><br />
						<label for="name">Name:</label><br />
						<input
							type="text"
							class="submit_field"
							id="name"
							name="name"
						/><br />
						<label for="name">Description:</label><br />
						<input
							type="text"
							class="submit_field"
							id="description"
							name="description"
						/><br />
						<label for="name">Price:</label><br />
						<input
							type="text"
							class="submit_field"
							id="price"
							name="price"
						/><br />
						<label for="name">Quantity:</label><br />
						<input
							type="text"
							class="submit_field"
							id="quantity"
							name="quantity"
						/><br />
						<input type="submit" class="submit" value="Submit" />
					</form>

					<!-- From for updating a Product field -->
					<h1>Update Product Field</h1>
					<form id="update-form">
						<label for="update-id">Product ID:</label><br />
						<input
							type="text"
							class="submit_field"
							id="update-id"
							name="update-id"
						/><br />
						<label for="field">Field:</label><br />
						<select id="field" class="submit_field" name="field">
							<option value=""></option>
							<option value="supplier">Supplier ID</option>
							<option value="name">Name</option>
							<option value="description">Description</option>
							<option value="price">Price</option>
							<option value="quantity">Quantity</option></select
						><br />
						<label for="new-value">New Value:</label><br />
						<input
							type="text"
							class="submit_field"
							id="new-value"
							name="new-value"
						/><br />
						<input type="submit" class="submit" value="Submit" />
					</form>

					<!-- Form for getting Product by ID -->
					<h1>Get Product by ID</h1>
					<form id="get-form">
						<label for="get-id">Product ID:</label><br />
						<input
							type="text"
							class="submit_field"
							id="get-id"
							name="get-id"
						/><br />
						<input type="submit" class="submit" value="Submit" />
					</form>

					<!-- Form for getting a Product by name -->
					<h1>Get Product by Name</h1>
					<form id="get-name-form">
						<label for="get-name">Product Name:</label><br />
						<input
							class="submit_field"
							type="text"
							id="search-name"
							name="search-name"
						/><br />
						<button class="submit" id="search-button">
							Search
						</button>
					</form>
				</div>
				<div>
					<div id="result"></div>
				</div>
			</div>
		</div>
		<script>
			function appendData(row, product) {
				var order = [
					"id",
					"supplier_id",
					"product_name",
					"product_description",
					"product_price",
					"product_quantity",
				];
				order.forEach(function (key) {
					row.append("<td>" + product[key] + "</td>");
				});
			}

			function sendRequest(url, type, data) {
				$.ajax({
					url: url,
					type: type,
					contentType: "application/json",
					data: JSON.stringify(data),
					success: function (response) {
						var products = response.data;
						var table = $("<table class='table'>");
						table.append(
							"<tr><th>ID</th><th>Supplier ID</th><th>Product</th><th>Description</th><th>Price</th><th>Quantity</th></tr>"
						);
						products.forEach(function (product) {
							var row = $("<tr>");
							appendData(row, product);
							table.append(row);
						});
						$("#result").html(table);
					},
					error: function (response) {
						$("#result").html(JSON.stringify(response));
					},
				});
			}

			$("#add-form").submit(function (event) {
				event.preventDefault();

				var supplier = $("#supplier_id").val();
				var name = $("#name").val();
				var description = $("#description").val();
				var price = $("#price").val();
				var quantity = $("#quantity").val();

				sendRequest(`http://localhost:5000/v1/product`, "POST", {
					supplier_id: supplier,
					product_name: name,
					product_description: description,
					product_price: price,
					product_quantity: quantity,
				});
			});

			$("#get-form").submit(function (event) {
				event.preventDefault();

				var id = $("#get-id").val();

				sendRequest(
					`http://localhost:5000/v1/product/${id}`,
					"GET",
					{}
				);
			});

			$("#update-form").submit(function (event) {
				event.preventDefault();

				var id = $("#update-id").val();
				var field = $("#field").val();
				var newValue = $("#new-value").val();

				sendRequest(
					`http://localhost:5000/v1/product/${id}/${field}`,
					"PUT",
					{ new_value: newValue }
				);
			});

			$("#get-all").click(function () {
				sendRequest(`http://localhost:5000/v1/product/all`, "GET", {});
			});

			$("#get-name-form").submit(function (event) {
				event.preventDefault();

				var name = $("#search-name").val();
				sendRequest(`http://localhost:5000/v1/product/name/${name}`);
			});
		</script>
	</body>
</html>
